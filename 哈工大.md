# 哈工大编译原理知识点总结

## 绪论

### 1.计算机程序设计语言及编译

- 机器语言（machine language）
  - **可以被计算机直接理解**
  - 与人类表达习惯相去甚远
  - 难记忆
  - 难编写
  - 难阅读
  - 易写错
- 汇编语言（Assembly language）
  - **引入助记符**
  - 依赖于特定的机器，非计算机专业人员使用受到限制
  - 编写效率依然很低
- 高级语言（High Level Language）
  - **类似于数学定义或自然语言的简洁形式**
  - 接近人类表达习惯
  - 不依赖于特定机器
  - 编写效率高
- ![1](.\图片\1.png)

**编译**：将**高级语言（源语言）**翻译成**汇编语言或机器语言(目标语言)**的过程

### 2.编译器在语言处理系统中的位置

- 源程序

**预处理器**(Preprocessor):把存储在不同文件中的源程序聚合在一起；把称为宏的缩写语句转换为原始语句

- 经过预处理的源程序

**编译器**

- 汇编语言程序

**汇编器**

- 可重定位的机器代码：**可重定位**在内存中存放的起始位置L不是固定的

**链接器/加载器**：**加载器**修改可重定位地址；将修改后的指令和数据放到内存中适当的位置

​                            **链接器**将多个可重定位的机器代码文件连接到一起；解决外部内存地址问题

​                            **库文件**其他可重定位目标程序

- 目标机器代码

> 起始位置 + 相对地址 = 绝对地址

![image-20221010195946314](.\图片\3)

![image-20221010195909219](.\图片\2.png)

![image-20221010200229657](.\图片\4)

### 3.编译系统的结构

> 高级程序语言——>编译器——>汇编语言程序/机器语言程序

![image-20221010200430224](.\图片\5)

![image-20221010200513007](.\图片\6.png)

![image-20221010200550219](.\图片\7)



#### 编译器的结构

- 字符流

**词法分析器**

- 语法单元流

**语法分析器**

- 语法树

**语义分析器**

- 语法树

**中间代码生成器**

- 中间表示形式

**机器无关代码优化器**

- 中间表示形式

**目标代码生成器**

- 目标机器语言

**机器相关代码生成器**

- 目标机器语言

![image-20221010201311970](.\图片\8)

#### 词法分析器——词法分析/扫描（Scanning）

**词法分析的主要任务**

从左向右逐行扫描源程序的字符，识别出各个单词，确定单词类型。

将识别出的单词转换成统一的机内表示——词法单元（token）形式

> token: <种别码，属性值>

![image-20221010201656673](.\图片\9)

![image-20221010201724214](.\图片\10)

#### 语法分析器（parser）

**语法分析器从词法分析器输出的token序列中识别出各类短语，并构造语法分析树（parse tree**）

语法分析树描述了句子的语法结构

![image-20221010202024559](.\图片\11)

##### 例1：赋值语句的分析树

> position = initial + rate * 60

![image-20221010202156229](.\图片\12)

##### 例2：变量声明语句的分析树

![image-20221010202335253](.\图片\13)

#### 语义分析器

**主要任务**：

1.***收集标识符的属性信息***

- 种属（kind）
  - 简单变量、复合变量（数组、记录、...）、过程、...

- 类型（type）
  - 整型、实型、字符型、布尔型、指针型、...
- 存储位置、长度

![image-20221010202931379](.\图片\14)

- 值
- 作用域
- 参数和返回值信息
  - 参数个数。参数类型。参数传递方式。返回值类型、...
- ![image-20221010203144183](.\图片\15)

***2.语义检查***

- 变量或过程**未经声明就使用**
- 变量或过程名**重复声明**
- **运算分量**类型不匹配
- **操作数**与**操作符**之间的类型不匹配
  - **数组下标**不是整数
  - 对**非数组变量**使用数组访问操作符
  - 对**非过程名**使用过程调用操作符
  - 过程调用的**参数类型或数目**不匹配
  - 函数**返回类型**有误

#### 中间代码生成器

##### 常用的中间表示形式

- **三地址码（Three-address Code）**
  - 三地址码由类似于汇编语言的指令序列组成，每个指令最多有三个操作数（operand）
  - 四元式（Quadruples）
    - (op,y,z,x)
  - 三元式（Triples）
  - 间接三元式（Indirect triples）

![image-20221010203946661](.\图片\16)

![image-20221010204311906](.\图片\17)

![image-20221010204405326](.\图片\18)


- **语法结构树/语法树（Syntax Trees）**



#### 编译器后端

##### 目标代码生成器

- 目标代码生成以源程序的**中间表示形式**作为输入，并把它映射到**目标语言**
- 目标代码生成的一个重要任务是为程序中使用的变量**合理分配寄存器**

##### 机器无关代码优化器

- **代码优化**
  - 为改进代码所进行的**等价程序变换**，使其**运行得更快一些**、**占用空间**更少一些，或者两者兼备



## 语法及其文法

### 基本概念

#### 字母表（Alphabet）

- 字母表Σ是一个**有穷符号集合**

  - 符号：字母、数字、标点符号、...

    ![image-20221010205405077](.\图片\19)

- 字母表上的运算

  - 字母表Σ1和Σ2的乘积：

    ![image-20221010205642398](.\图片\20)

  - 字母表Σ的n次幂

  ![image-20221010205733821](.\图片\21)

  - 字母表Σ的正闭包

  ![image-20221010205835182](.\图片\22)

  > 正闭包：长度为正数的符号串构成的集合

  - 字母表Σ的克林闭包

    ![image-20221010205955082](.\图片\23)

    > 克林闭包：任意符号串（长度可以为0）构成的集合

#### 串（String）

设Σ是一个字母表，对于其克林闭包中任意x，x被称为Σ上的一个串

- 串是字母表中**符号**的一个**有穷序列**
- 串s的**长度**，通常记作|s|，是指s中**符号的个数**
  - 例：|aab| = 3
- **空串**是**长度为0的串**，用 **ε（epsilon）**表示
  - | ε| = 0

##### 串上的运算

**连接**

- 如果x和y是串，那么x和y的连接（concatenation）是把y附加到x后面而形成的串，记作xy

  - 例如，如果x = dog 且 y = house，那么xy = doghouse

  - 空串是连接运算的单位元（identity），即，对于任何串s都有，**εs** **=** **sε** **=** **s** 

    ![image-20221010210817053](.\图片\24)

**幂**

- 串s的幂运算

  - s0= ε，
  -  sn = sn-1 * s, n ≥1

  - s1 = s0 s = εs = s，s2 = ss，s3 = sss，…
  - 例：如果 s =ba，那么s1= ba，s2=baba， s3=bababa，…

- > 串s的n次幂：将n个s连接起来



### 文法的定义

#### 自然语言的例子——句子构成规则

- <句子>——><名词短语><动词短语>
- <名词短语>——> <形容词><名词短语>
- <名词短语> ——>  <名词> 
- <动词短语> ——> <动词> <名词短语> 
- <形容词> ——>  little
- <名词>——> boy
- <名词> ——> apple
- <动词> ——> eat

> 未用尖括号括起来的部分：语言的基本符号
>
> 尖括号括起来的部分：语法成分

#### 文法的形式化定义

**G = (VT , VN , P , S )**

- **VT：终结符集合**

  终结符（terminal symbol）是文法所定义的语言的基本
  符号，有时也称为token

  - 例: VT = { apple, boy, eat, little }

- **VN：非终结符集合**
  非终结符(nonterminal) 是用来表示语法成分的符号，
  有时也称为“ 语法变量”

  - 例: VN = { <句子>, <名词短语>, <动词短语>,<名 词>, … }

- **P:产生式集合**

  产生式( production)描述了将终结符和非终结符组合成串的方法
  产生式的一般形式：
  **α→β**

  读作：α定义为β

  - α∈(VT∪VN)+，且α中至少包含VN中的一个元素：称为产生式的头 (head )或左部(left side) 
  - β∈(VT∪VN)* ：称为产生式的体(body)或右部(right side)
  - ![image-20221010212215671](.\图片\25)

- **S ：开始符号**

  S∈VN。开始符号(start symbol)表示的是该文法中最大的语法成分

  - 例：S = <句子>
  - ![image-20221010212347521](.\图片\26)

##### **产生式的简写**

  - 对一组有**相同左部**的α产生式：α→β1, α→β2, … , α→βn  读作：α定义为β1，或者β2，…，或者βn 。β1，β2，…，βn称为α的候选式(Candidate)
  - ![image-20221010212716368](.\图片\27)

##### 符号约定

  - 下述符号是**终结符**
    - (a) 字母表中**排在前面的小写字母**，如 a、b、c 
    - (b) **运算符**，如 +、*等 
    - ( c ) **标点符号**，如括号、逗号等
    - (d) **数字**0、1、. . . 、9 
    - ( e ) **粗体字符串**，如id、if等
  - 下列符号是**非终结符**
    - (a) 字母表中**排在前面的大写字母**，如A、B、 C 
    - (b) 字母S。通常表示开始符号
    - ( c ) **小写、斜体的名字**，如 expr、stmt等 
    - (d) **代表程序构造的大写字母**。如E(表达式)、T(项) 和F(因子)
  - 字母表中排在后面的大写字母（如X、Y、Z）表示**文法符号**（即终结符或非终结符）
  - 字母表中排在后面的小写字母（主要是u、v、. . . 、z）表示**终结符号串**（包括空串） 
  - **小写希腊字母**，如α、β、γ，表示**文法符号串**（包括空串） 
  - 除非特别说明，**第一个产生式的左部**就是**开始符号**



#### 语言的定义

##### 自然语言的例子

1. <句子> ——> <单词短语> <动词短语>
2. <名词短语> ——> <形容词> <名词短语>
3. <名词短语> ——> <名词>
4. <动词短语> ——> <动词> <名词短语>
5. <形容词> ——> little
6. <名词> ——> boy
7. <名词> ——> apple
8. <动词> ——> eat

单词串：little boy eats apple

##### 推导（Derivation）和归约（Reductions）

- 给定文法G=(VT , VN , P , S )，如果 α→β ∈ P，那么可以将字符串串γαδ中的α**替换**为β，也就是说，将γαδ **重写(rewrite)**为γβδ，记作 γαδ => γβδ。此时，称文法中的符号串 γαδ **直接推导(directly derive)**出 γβδ
  简而言之，就是用**产生式的右部替换产生式的左部**
- 如果α0 => α1，α1 => α2，α2 => α3，…，αn-1 => αn，则
  可以记作α0 => α1 => α2 => α3 =>  … =>  αn-1 => αn，称符
  号串 α0经过n步推导出αn，可简记为α0n αn
  ➢ α  => 0 α
  ➢  => +表示“经过正数步推导”
  ➢  => *表示“经过若干（可以是0）步推导”

![image-20221012125916543](.\图片\44.png)



















